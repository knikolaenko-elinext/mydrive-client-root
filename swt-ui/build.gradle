buildscript {
    repositories {
        maven {
            url 'https://plugins.gradle.org/m2/'
        }
    }
    dependencies {
        classpath 'gradle.plugin.edu.sc.seis.gradle:launch4j:1.5.4'
    }
}

apply plugin: 'application'
apply plugin: 'edu.sc.seis.launch4j'

dependencies {
    compile 'log4j:log4j:1.2.17'
    compile 'org.eclipse.swt:org.eclipse.swt.win32.win32.x86_64:4.3'
    compile project(':core')
}

mainClassName = "ch.mydrive.Main"

launch4j {
    mainClassName = 'ch.mydrive.Main'
    icon = '../../assets/app-logo.ico'
    outfile = 'mydrive.exe'
}

task signForJnlp << {
    mkdir ('build/jnlp');
    file('build/install/swt-ui/lib').listFiles().each {
        ant.signjar(
                jar: it.absolutePath,
                alias: 'selfsigned',
                keystore: 'sign/keystore.jks',
                storepass: 'password',
                keypass: 'password',
                signedjar: 'build/jnlp/'+it.name);
    }
}
signForJnlp.dependsOn installDist

task moveJnlpDescriptor(type: Copy) {
    from "dist-assets/mydrive.jnlp"
    from "assets/app-logo.ico"
    into 'build/jnlp'
}

task installJnlp(dependsOn:["signForJnlp", "moveJnlpDescriptor"])

